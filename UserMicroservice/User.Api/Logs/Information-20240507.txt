2024-05-07 17:04:52.549 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 17:04:52.787 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 17:04:52.787 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 17:04:52.826 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 17:04:52.826 +03:00 [INF] Hosting environment: Development
2024-05-07 17:04:52.826 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 17:04:55.850 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 17:04:56.099 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 259.6247ms
2024-05-07 17:04:56.138 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 17:04:56.138 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 17:04:56.148 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 10.5981ms
2024-05-07 17:04:56.217 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 79.2569ms
2024-05-07 17:04:56.511 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 17:04:56.665 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 154.3986ms
2024-05-07 17:06:06.648 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 112
2024-05-07 17:06:07.898 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:06:07.916 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:06:10.526 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:06:10.693 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [Phone])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2024-05-07 17:06:10.728 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'Users.Percistance.AppDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b6421a54-031c-4747-89fb-2131ae3e8ec6
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b6421a54-031c-4747-89fb-2131ae3e8ec6
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-05-07 17:06:11.006 +03:00 [INF] Executed action User.Api.Controllers.UserController.Post (User.Api) in 3087.9357ms
2024-05-07 17:06:11.007 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:06:11.011 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b6421a54-031c-4747-89fb-2131ae3e8ec6
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Users.Percistance.SqlServerBaseReository`1.AddAsync(TEntity item, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Percistance\SqlServerBaseReository.cs:line 32
   at Users.Application.Comands.CreateUser.CreateUserComandHendler.Handle(CreateUserComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\CreateUser\CreateUserComandHendler.cs:line 43
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.Post(CreateUserComand item, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 48
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 17:06:11.046 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7276/users - 500 null text/plain; charset=utf-8 4398.795ms
2024-05-07 17:07:26.171 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 17:07:26.489 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 17:07:26.489 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 17:07:26.540 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 17:07:26.540 +03:00 [INF] Hosting environment: Development
2024-05-07 17:07:26.540 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 17:07:27.715 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 17:07:27.949 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 239.1916ms
2024-05-07 17:07:27.987 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 17:07:27.987 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 17:07:27.993 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 6.1441ms
2024-05-07 17:07:28.034 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 46.9722ms
2024-05-07 17:07:28.303 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 17:07:28.412 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 109.7234ms
2024-05-07 17:08:20.359 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 107
2024-05-07 17:08:20.485 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:08:20.504 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:08:21.865 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:08:22.093 +03:00 [INF] Executed action User.Api.Controllers.UserController.Post (User.Api) in 1585.7425ms
2024-05-07 17:08:22.094 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:08:22.098 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.ArgumentException: Phone number has incorrect format (Parameter 'phone')
   at Users.Domain.AppUser.UpdatePhone(String phone) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Domain\AppUser.cs:line 65
   at Users.Application.Comands.CreateUser.CreateUserComandHendler.Handle(CreateUserComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\CreateUser\CreateUserComandHendler.cs:line 42
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.Post(CreateUserComand item, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 48
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 17:08:22.142 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7276/users - 500 null text/plain; charset=utf-8 1782.9098ms
2024-05-07 17:09:06.870 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 17:09:07.302 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 17:09:07.302 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 17:09:07.365 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 17:09:07.366 +03:00 [INF] Hosting environment: Development
2024-05-07 17:09:07.366 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 17:09:08.606 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 17:09:08.857 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 260.0454ms
2024-05-07 17:09:08.889 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 17:09:08.889 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 17:09:08.895 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 6.0101ms
2024-05-07 17:09:08.933 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.0107ms
2024-05-07 17:09:09.012 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 17:09:09.128 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 116.3719ms
2024-05-07 17:09:52.115 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 112
2024-05-07 17:09:52.237 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:09:52.266 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:09:53.528 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:09:53.694 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 50), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [Phone])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2024-05-07 17:09:53.727 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'Users.Percistance.AppDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-05-07 17:09:53.992 +03:00 [INF] Executed action User.Api.Controllers.UserController.Post (User.Api) in 1723.683ms
2024-05-07 17:09:53.993 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:09:53.998 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Users.Percistance.SqlServerBaseReository`1.AddAsync(TEntity item, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Percistance\SqlServerBaseReository.cs:line 32
   at Users.Application.Comands.CreateUser.CreateUserComandHendler.Handle(CreateUserComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\CreateUser\CreateUserComandHendler.cs:line 45
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.Post(CreateUserComand item, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 48
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 17:09:54.021 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7276/users - 500 null text/plain; charset=utf-8 1906.3089ms
2024-05-07 17:10:22.047 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 112
2024-05-07 17:10:22.058 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:10:22.059 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:10:22.082 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:14:15.682 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 50), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [Phone])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2024-05-07 17:14:15.700 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'Users.Percistance.AppDBContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-05-07 17:14:15.960 +03:00 [INF] Executed action User.Api.Controllers.UserController.Post (User.Api) in 233900.5451ms
2024-05-07 17:14:15.960 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:14:15.961 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'Email', table 'CycleServiceDB.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:75a8b8c0-8587-4de2-9a9c-e54b6057b337
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Users.Percistance.SqlServerBaseReository`1.AddAsync(TEntity item, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Percistance\SqlServerBaseReository.cs:line 32
   at Users.Application.Comands.CreateUser.CreateUserComandHendler.Handle(CreateUserComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\CreateUser\CreateUserComandHendler.cs:line 45
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.Post(CreateUserComand item, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 48
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 17:14:15.983 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7276/users - 500 null text/plain; charset=utf-8 233921.6107ms
2024-05-07 17:14:28.611 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 112
2024-05-07 17:14:28.617 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:14:28.617 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:14:28.679 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:16:00.295 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 17:16:00.690 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 17:16:00.690 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 17:16:00.732 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 17:16:00.732 +03:00 [INF] Hosting environment: Development
2024-05-07 17:16:00.732 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 17:16:01.948 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 17:16:02.212 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 271.532ms
2024-05-07 17:16:02.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 17:16:02.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 17:16:02.268 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 12.4872ms
2024-05-07 17:16:02.318 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 63.0602ms
2024-05-07 17:16:02.385 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 17:16:02.566 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 180.6472ms
2024-05-07 17:16:38.666 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7276/users - application/json 112
2024-05-07 17:16:38.779 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:16:38.797 +03:00 [INF] Route matched with {action = "Post", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(Users.Application.Comands.CreateUser.CreateUserComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:16:40.036 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__Trim_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Login] = @__Trim_0
2024-05-07 17:16:42.964 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 50), @p2='?' (Size = 4000), @p3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [Phone])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2024-05-07 17:16:42.993 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Client'
2024-05-07 17:16:43.029 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AppUserAppRole] ([RoleId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2024-05-07 17:16:43.059 +03:00 [INF] Executing CreatedResult, writing value of type 'Users.Application.dto.GetUserDto'.
2024-05-07 17:16:43.064 +03:00 [INF] Executed action User.Api.Controllers.UserController.Post (User.Api) in 4263.9903ms
2024-05-07 17:16:43.064 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.Post (User.Api)'
2024-05-07 17:16:43.071 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7276/users - 201 null application/json; charset=utf-8 4405.0668ms
2024-05-07 17:20:09.110 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/users - null null
2024-05-07 17:20:09.128 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.GetAll (User.Api)'
2024-05-07 17:20:09.135 +03:00 [INF] Route matched with {action = "GetAll", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(Users.Application.Query.GetAll.GetListQuery, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 17:20:09.183 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
ORDER BY [u].[Id]
2024-05-07 17:20:09.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE 0 = 1
2024-05-07 17:20:09.213 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Users.Application.dto.GetUserDto, Users.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-05-07 17:20:09.214 +03:00 [INF] Executed action User.Api.Controllers.UserController.GetAll (User.Api) in 79.4508ms
2024-05-07 17:20:09.214 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.GetAll (User.Api)'
2024-05-07 17:20:09.215 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/users - 200 null application/json; charset=utf-8 106.2526ms
2024-05-07 18:00:34.797 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:00:35.113 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:00:35.113 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:00:35.151 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:00:35.151 +03:00 [INF] Hosting environment: Development
2024-05-07 18:00:35.151 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:00:36.219 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:00:36.470 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 258.5421ms
2024-05-07 18:00:36.499 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:00:36.499 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:00:36.512 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 13.0465ms
2024-05-07 18:00:36.551 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 51.6704ms
2024-05-07 18:00:36.641 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:00:36.756 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 115.4385ms
2024-05-07 18:01:14.662 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:01:15.151 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:01:15.151 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:01:15.253 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:01:15.253 +03:00 [INF] Hosting environment: Development
2024-05-07 18:01:15.254 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:01:16.462 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:01:16.622 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 168.7553ms
2024-05-07 18:01:16.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:01:16.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:01:16.654 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 5.0092ms
2024-05-07 18:01:16.698 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 49.3254ms
2024-05-07 18:01:16.765 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:01:16.888 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 123.127ms
2024-05-07 18:01:39.954 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:01:40.970 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:01:40.991 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:01:43.808 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:01:43.876 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:01:43.992 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AppUserAppRole] ([RoleId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2024-05-07 18:01:44.302 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 3307.3614ms
2024-05-07 18:01:44.302 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:01:44.305 +03:00 [ERR] An unhandled exception has occurred while executing the request.
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
AppUserAppRole -> GetUserDto
Users.Domain.AppUserAppRole -> Users.Application.dto.GetUserDto
   at lambda_method154(Closure, Object, GetUserDto, ResolutionContext)
   at Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComandHandler.Handle(GiveUserAdminRoleComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\GiveUserAdminRole\GiveUserAdminRoleComandHandler.cs:line 72
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.MakeAdmin(GiveUserAdminRoleComand comand, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 64
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 18:01:44.355 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 500 null text/plain; charset=utf-8 4401.6332ms
2024-05-07 18:08:23.813 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:08:24.108 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:08:24.108 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:08:24.146 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:08:24.147 +03:00 [INF] Hosting environment: Development
2024-05-07 18:08:24.147 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:08:25.571 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:08:25.795 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 235.8284ms
2024-05-07 18:08:25.829 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:08:25.829 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:08:25.842 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 14.1141ms
2024-05-07 18:08:25.876 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 47.9446ms
2024-05-07 18:08:25.961 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:08:26.064 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 102.8544ms
2024-05-07 18:08:44.713 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:08:44.832 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:08:44.856 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:08:46.101 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:08:46.170 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:08:46.297 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AppUserAppRole] ([RoleId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2024-05-07 18:08:46.339 +03:00 [INF] Executing OkObjectResult, writing value of type 'Users.Application.dto.GetUserDto'.
2024-05-07 18:08:46.344 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 1485.8825ms
2024-05-07 18:08:46.345 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:08:46.353 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 200 null application/json; charset=utf-8 1641.6266ms
2024-05-07 18:14:36.079 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:14:36.348 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:14:36.348 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:14:36.389 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:14:36.389 +03:00 [INF] Hosting environment: Development
2024-05-07 18:14:36.389 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:14:37.509 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:14:37.709 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 206.3161ms
2024-05-07 18:14:37.747 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:14:37.747 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:14:37.754 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 7.1371ms
2024-05-07 18:14:37.795 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 48.9877ms
2024-05-07 18:14:37.877 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:14:37.977 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 100.3819ms
2024-05-07 18:14:48.786 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/users - null null
2024-05-07 18:14:48.907 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-05-07 18:14:48.908 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-05-07 18:14:48.912 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.GetAll (User.Api)'
2024-05-07 18:14:48.932 +03:00 [INF] Route matched with {action = "GetAll", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(Users.Application.Query.GetAll.GetListQuery, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:14:50.172 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
ORDER BY [u].[Id]
2024-05-07 18:14:50.276 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE 0 = 1
2024-05-07 18:14:50.283 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Users.Application.dto.GetUserDto, Users.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-05-07 18:14:50.288 +03:00 [INF] Executed action User.Api.Controllers.UserController.GetAll (User.Api) in 1352.9415ms
2024-05-07 18:14:50.289 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.GetAll (User.Api)'
2024-05-07 18:14:50.295 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/users - 200 null application/json; charset=utf-8 1509.4905ms
2024-05-07 18:15:20.874 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:15:20.883 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-05-07 18:15:20.883 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10503: Signature validation failed. Token does not have a kid. Keys tried: '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.Text.StringBuilder' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-05-07 18:15:20.888 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2024-05-07 18:15:20.891 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-05-07 18:15:20.892 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 401 0 null 18.8078ms
2024-05-07 18:15:55.352 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:15:55.371 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:15:55.375 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:15:55.436 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:15:55.444 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:15:55.457 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:15:55.677 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 301.8872ms
2024-05-07 18:15:55.677 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:15:55.678 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Users.Service.Exeptions.BadRequestExeption: Allready admin
   at Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComandHandler.Handle(GiveUserAdminRoleComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\GiveUserAdminRole\GiveUserAdminRoleComandHandler.cs:line 78
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.MakeAdmin(GiveUserAdminRoleComand comand, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 64
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 18:15:55.709 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 500 null text/plain; charset=utf-8 356.8864ms
2024-05-07 18:16:12.075 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:16:12.076 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:16:12.077 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:16:12.146 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:16:12.149 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:16:14.895 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:16:26.959 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:16:27.330 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:16:27.330 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:16:27.410 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:16:27.411 +03:00 [INF] Hosting environment: Development
2024-05-07 18:16:27.411 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:16:28.501 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:16:28.729 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 231.897ms
2024-05-07 18:16:28.781 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:16:28.781 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:16:28.786 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 5.4265ms
2024-05-07 18:16:28.837 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 56.0646ms
2024-05-07 18:16:28.916 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:16:29.013 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 98.0737ms
2024-05-07 18:16:59.266 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:16:59.374 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:16:59.394 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:17:00.650 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:17:00.714 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:17:03.747 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:17:03.938 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 4541.1482ms
2024-05-07 18:17:03.938 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:17:03.942 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Users.Service.Exeptions.BadRequestExeption: Allready admin
   at Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComandHandler.Handle(GiveUserAdminRoleComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\GiveUserAdminRole\GiveUserAdminRoleComandHandler.cs:line 78
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.MakeAdmin(GiveUserAdminRoleComand comand, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 64
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 18:17:03.989 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 500 null text/plain; charset=utf-8 4723.2156ms
2024-05-07 18:17:57.522 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:17:57.864 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:17:57.864 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:17:57.926 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:17:57.926 +03:00 [INF] Hosting environment: Development
2024-05-07 18:17:57.926 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:17:58.953 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:17:59.175 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 229.1509ms
2024-05-07 18:17:59.224 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:17:59.228 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:17:59.230 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 6.3185ms
2024-05-07 18:17:59.354 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 126.144ms
2024-05-07 18:17:59.405 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:17:59.517 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 111.8702ms
2024-05-07 18:18:51.160 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:18:51.456 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:18:51.457 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:18:51.542 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:18:51.542 +03:00 [INF] Hosting environment: Development
2024-05-07 18:18:51.542 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:18:52.799 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:18:53.005 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 213.4334ms
2024-05-07 18:18:53.050 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:18:53.050 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:18:53.057 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 6.7036ms
2024-05-07 18:18:53.107 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 56.5394ms
2024-05-07 18:18:53.183 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:18:53.311 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 127.8312ms
2024-05-07 18:19:13.815 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:19:13.926 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:19:13.945 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:19:15.162 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:19:15.229 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:19:15.242 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:20:10.323 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-07 18:20:10.560 +03:00 [INF] Now listening on: https://localhost:7276
2024-05-07 18:20:10.560 +03:00 [INF] Now listening on: http://localhost:5195
2024-05-07 18:20:10.597 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-07 18:20:10.597 +03:00 [INF] Hosting environment: Development
2024-05-07 18:20:10.597 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api
2024-05-07 18:20:11.710 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/index.html - null null
2024-05-07 18:20:11.942 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/index.html - 200 null text/html;charset=utf-8 238.8003ms
2024-05-07 18:20:11.969 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_vs/browserLink - null null
2024-05-07 18:20:11.969 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - null null
2024-05-07 18:20:11.974 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_framework/aspnetcore-browser-refresh.js - 200 13752 application/javascript; charset=utf-8 4.8866ms
2024-05-07 18:20:12.010 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/_vs/browserLink - 200 null text/javascript; charset=UTF-8 41.3196ms
2024-05-07 18:20:12.092 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - null null
2024-05-07 18:20:12.218 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7276/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 126.4883ms
2024-05-07 18:20:27.053 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:20:27.183 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:20:27.205 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:20:28.433 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:20:28.497 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:20:28.509 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:20:28.620 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AppUserAppRole] ([RoleId], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2024-05-07 18:20:28.662 +03:00 [INF] Executing OkObjectResult, writing value of type 'Users.Application.dto.GetUserDto'.
2024-05-07 18:20:28.666 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 1458.6992ms
2024-05-07 18:20:28.667 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:20:28.672 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 200 null application/json; charset=utf-8 1619.858ms
2024-05-07 18:20:31.992 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7276/users/MakeAdmin - application/json 13
2024-05-07 18:20:31.995 +03:00 [INF] Executing endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:20:31.996 +03:00 [INF] Route matched with {action = "MakeAdmin", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MakeAdmin(Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComand, MediatR.IMediator, System.Threading.CancellationToken) on controller User.Api.Controllers.UserController (User.Api).
2024-05-07 18:20:32.018 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[Phone]
FROM [Users] AS [u]
WHERE [u].[Id] = @__request_Id_0
2024-05-07 18:20:32.019 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[Name]
FROM [AppUserRole] AS [a]
WHERE [a].[Name] = N'Admin'
2024-05-07 18:20:32.021 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_user_Id_0='?' (DbType = Int32), @__adminRole_Id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[RoleId], [a].[UserId]
FROM [AppUserAppRole] AS [a]
WHERE [a].[UserId] = @__8__locals1_user_Id_0 AND [a].[RoleId] = @__adminRole_Id_1
2024-05-07 18:20:32.218 +03:00 [INF] Executed action User.Api.Controllers.UserController.MakeAdmin (User.Api) in 221.4998ms
2024-05-07 18:20:32.218 +03:00 [INF] Executed endpoint 'User.Api.Controllers.UserController.MakeAdmin (User.Api)'
2024-05-07 18:20:32.220 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Users.Service.Exeptions.BadRequestExeption: Allready admin
   at Users.Application.Comands.GiveUserAdminRole.GiveUserAdminRoleComandHandler.Handle(GiveUserAdminRoleComand request, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Requests\Comands\GiveUserAdminRole\GiveUserAdminRoleComandHandler.cs:line 78
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 25
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 32
   at Users.Application.Behaviors.ContextTransactionBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ContextTransactionBehavior.cs:line 34
   at Users.Application.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\UserMicroservice\Users.Application\Behaviors\ValidationBehavior.cs:line 24
   at User.Api.Controllers.UserController.MakeAdmin(GiveUserAdminRoleComand comand, IMediator mediator, CancellationToken cancellationToken) in D:\учёба\курсы ITA\Cycle Service\Cycle Service\User.Api\Controllers\UserController.cs:line 64
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-07 18:20:32.254 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7276/users/MakeAdmin - 500 null text/plain; charset=utf-8 261.7813ms
