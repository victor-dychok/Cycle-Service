2024-06-10 12:16:08.408 +03:00 [INF] User profile is available. Using 'C:\Users\vitia\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-06-10 12:16:08.686 +03:00 [INF] Now listening on: https://localhost:7014
2024-06-10 12:16:08.686 +03:00 [INF] Now listening on: http://localhost:5281
2024-06-10 12:16:08.688 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-10 12:16:08.688 +03:00 [INF] Hosting environment: Development
2024-06-10 12:16:08.688 +03:00 [INF] Content root path: D:\учёба\курсы ITA\Cycle Service\Cycle Service\RepairRequestMicroservice\RepairRequest.Api
2024-06-10 12:16:10.363 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger - null null
2024-06-10 12:16:10.611 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger - 301 0 null 259.7281ms
2024-06-10 12:16:10.616 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/index.html - null null
2024-06-10 12:16:10.728 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/index.html - 200 null text/html;charset=utf-8 112.4754ms
2024-06-10 12:16:10.845 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/swagger-ui.css - null null
2024-06-10 12:16:10.845 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/_framework/aspnetcore-browser-refresh.js - null null
2024-06-10 12:16:10.845 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/swagger-ui-standalone-preset.js - null null
2024-06-10 12:16:10.845 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/swagger-ui-bundle.js - null null
2024-06-10 12:16:10.855 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/_framework/aspnetcore-browser-refresh.js - 200 13770 application/javascript; charset=utf-8 9.8267ms
2024-06-10 12:16:10.864 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/_vs/browserLink - null null
2024-06-10 12:16:10.897 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2024-06-10 12:16:10.897 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2024-06-10 12:16:10.900 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/swagger-ui.css - 200 144929 text/css 55.2396ms
2024-06-10 12:16:10.900 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/swagger-ui-standalone-preset.js - 200 312163 text/javascript 54.4421ms
2024-06-10 12:16:10.927 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2024-06-10 12:16:10.928 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/swagger-ui-bundle.js - 200 1061536 text/javascript 82.3827ms
2024-06-10 12:16:10.945 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.1843ms
2024-06-10 12:16:11.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/v1/swagger.json - null null
2024-06-10 12:16:11.187 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7014/swagger/favicon-32x32.png - null null
2024-06-10 12:16:11.189 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2024-06-10 12:16:11.189 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/favicon-32x32.png - 200 628 image/png 2.8691ms
2024-06-10 12:16:11.305 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7014/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 132.2903ms
2024-06-10 16:40:36.740 +03:00 [INF] Executed DbCommand (216ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [CycleServiceDB];
2024-06-10 16:40:36.814 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [CycleServiceDB] SET READ_COMMITTED_SNAPSHOT ON;
END;
2024-06-10 16:40:36.827 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2024-06-10 16:40:36.875 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [__EFMigrationsHistory] (
    [MigrationId] nvarchar(150) NOT NULL,
    [ProductVersion] nvarchar(32) NOT NULL,
    CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
);
2024-06-10 16:40:36.876 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2024-06-10 16:40:36.888 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2024-06-10 16:40:36.891 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2024-06-10 16:40:36.900 +03:00 [INF] Applying migration '20240507115405_Initial'.
2024-06-10 16:40:36.934 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [AppUserRole] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_AppUserRole] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Components] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Price] int NOT NULL,
    CONSTRAINT [PK_Components] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.937 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RequestStatuses] (
    [Id] int NOT NULL IDENTITY,
    [StatusName] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_RequestStatuses] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.938 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Services] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Price] int NOT NULL,
    CONSTRAINT [PK_Services] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.939 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [ServicesCenters] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [Location] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_ServicesCenters] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.940 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Login] nvarchar(max) NOT NULL,
    [PasswordHash] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [Phone] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id])
);
2024-06-10 16:40:36.942 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [AppUserAppRole] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [RoleId] int NOT NULL,
    CONSTRAINT [PK_AppUserAppRole] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_AppUserAppRole_AppUserRole_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [AppUserRole] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_AppUserAppRole_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);
2024-06-10 16:40:36.943 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Requests] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [MasterId] int NOT NULL,
    [StatusId] int NOT NULL,
    [RequestStatusId] int NOT NULL,
    CONSTRAINT [PK_Requests] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Requests_RequestStatuses_RequestStatusId] FOREIGN KEY ([RequestStatusId]) REFERENCES [RequestStatuses] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Requests_Users_MasterId] FOREIGN KEY ([MasterId]) REFERENCES [Users] ([Id]),
    CONSTRAINT [FK_Requests_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id])
);
2024-06-10 16:40:36.945 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RepairRequestComponent] (
    [Id] int NOT NULL IDENTITY,
    [RepairRequestId] int NOT NULL,
    [ComponentId] int NOT NULL,
    CONSTRAINT [PK_RepairRequestComponent] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_RepairRequestComponent_Components_ComponentId] FOREIGN KEY ([ComponentId]) REFERENCES [Components] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_RepairRequestComponent_Requests_RepairRequestId] FOREIGN KEY ([RepairRequestId]) REFERENCES [Requests] ([Id]) ON DELETE CASCADE
);
2024-06-10 16:40:36.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RepairRequestService] (
    [Id] int NOT NULL IDENTITY,
    [RepairRequestId] int NOT NULL,
    [ServiceId] int NOT NULL,
    CONSTRAINT [PK_RepairRequestService] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_RepairRequestService_Requests_RepairRequestId] FOREIGN KEY ([RepairRequestId]) REFERENCES [Requests] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_RepairRequestService_Services_ServiceId] FOREIGN KEY ([ServiceId]) REFERENCES [Services] ([Id]) ON DELETE CASCADE
);
2024-06-10 16:40:36.947 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_AppUserAppRole_RoleId] ON [AppUserAppRole] ([RoleId]);
2024-06-10 16:40:36.947 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_AppUserAppRole_UserId] ON [AppUserAppRole] ([UserId]);
2024-06-10 16:40:36.948 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RepairRequestComponent_ComponentId] ON [RepairRequestComponent] ([ComponentId]);
2024-06-10 16:40:36.948 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RepairRequestComponent_RepairRequestId] ON [RepairRequestComponent] ([RepairRequestId]);
2024-06-10 16:40:36.949 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RepairRequestService_RepairRequestId] ON [RepairRequestService] ([RepairRequestId]);
2024-06-10 16:40:36.949 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RepairRequestService_ServiceId] ON [RepairRequestService] ([ServiceId]);
2024-06-10 16:40:36.950 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Requests_MasterId] ON [Requests] ([MasterId]);
2024-06-10 16:40:36.950 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Requests_RequestStatusId] ON [Requests] ([RequestStatusId]);
2024-06-10 16:40:36.951 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Requests_UserId] ON [Requests] ([UserId]);
2024-06-10 16:40:36.952 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240507115405_Initial', N'8.0.4');
2024-06-10 16:40:36.956 +03:00 [INF] Applying migration '20240507130103_Refresh-tokens'.
2024-06-10 16:40:37.026 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'Login');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [Users] ALTER COLUMN [Login] nvarchar(50) NOT NULL;
2024-06-10 16:40:37.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RefreshTokens] (
    [Id] nvarchar(450) NOT NULL DEFAULT (NEWID()),
    [UserId] int NOT NULL,
    CONSTRAINT [PK_RefreshTokens] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_RefreshTokens_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);
2024-06-10 16:40:37.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_Users_Login] ON [Users] ([Login]);
2024-06-10 16:40:37.028 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RefreshTokens_UserId] ON [RefreshTokens] ([UserId]);
2024-06-10 16:40:37.028 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240507130103_Refresh-tokens', N'8.0.4');
2024-06-10 16:40:37.029 +03:00 [INF] Applying migration '20240508135824_Service-ServiceCenter-Relation'.
2024-06-10 16:40:37.043 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Services] ADD [ServiceCenterId] int NOT NULL DEFAULT 0;
2024-06-10 16:40:37.044 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Services_ServiceCenterId] ON [Services] ([ServiceCenterId]);
2024-06-10 16:40:37.045 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Services] ADD CONSTRAINT [FK_Services_ServicesCenters_ServiceCenterId] FOREIGN KEY ([ServiceCenterId]) REFERENCES [ServicesCenters] ([Id]) ON DELETE CASCADE;
2024-06-10 16:40:37.045 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240508135824_Service-ServiceCenter-Relation', N'8.0.4');
2024-06-10 16:40:37.045 +03:00 [INF] Applying migration '20240515082154_service-center-master-relation'.
2024-06-10 16:40:37.059 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [ServicesCenters] ADD [MasterId] int NOT NULL DEFAULT 0;
2024-06-10 16:40:37.060 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_ServicesCenters_MasterId] ON [ServicesCenters] ([MasterId]);
2024-06-10 16:40:37.060 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [ServicesCenters] ADD CONSTRAINT [FK_ServicesCenters_Users_MasterId] FOREIGN KEY ([MasterId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE;
2024-06-10 16:40:37.061 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20240515082154_service-center-master-relation', N'8.0.4');
